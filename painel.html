<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Gráficos - EJL Saúde e Segurança</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f0f8f5; }
    .hidden { display: none; }
    .center { text-align: center; margin-top: 50px; }
    input[type="password"] { padding: 10px; width: 200px; }
    button { padding: 10px 20px; background-color: #2e7d32; color: white; border: none; cursor: pointer; }
    .chart-container { margin: 30px 0; display: flex; align-items: center; }
    .chart-container canvas { max-height: 200px; max-width: 600px; }
    .summary { background: #e8f5e9; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
    select { margin: 10px; padding: 5px; }
    .question-label { width: 300px; font-size: 0.9em; margin-right: 10px; }
  </style>
</head>
<body>

<div id="login" class="center">
  <h2>Painel de Gráficos - Login</h2>
  <input type="password" id="password" placeholder="Digite a senha">
  <button onclick="checkPassword()">Entrar</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="panel" class="hidden">
  <h1>Painel de Gráficos - EJL Saúde e Segurança</h1>
  <div class="summary" id="summary"></div>
  <label for="chartType">Tipo de Gráfico:</label>
  <select id="chartType" onchange="reloadCharts()">
    <option value="bar">Coluna</option>
    <option value="pie">Pizza</option>
    <option value="doughnut">Rosca</option>
  </select>
  <div id="charts"></div>
</div>

<script>
const senhaCorreta = 'admin123';
let globalData = null;

const perguntasTextos = [
  '1. Você tem que realizar atividades que não fazem parte da sua função?',
  '2. A função que você exerce exige um ritmo de trabalho intenso?',
  '3. Seu trabalho exige novas ideias?',
  '4. Seu trabalho exige que saiba lidar com tensão?',
  '5. Você discorda de algumas funções atribuídas?',
  '6. Você se sente inseguro na sua habilidade?',
  '7. Você pode realizar seu trabalho sem pressa?',
  '8. Você se sente tenso durante a atividade?',
  '9. Você está sobrecarregado?',
  '10. Você sente dificuldade para se concentrar?',
  '11. Você toma decisões arriscadas?',
  '12. A empresa respeita o bem-estar dos colaboradores?',
  '13. Já recebeu ofensas no ambiente de trabalho?',
  '14. Já foi exposto publicamente com informações confidenciais?',
  '15. Recebe comentários desagradáveis sobre cor, orientação ou religião?',
  '16. Empresa incentiva seu desenvolvimento?',
  '17. Está irritado?',
  '18. Pode confiar nos colegas?',
  '19. Você se sente preocupado com o trabalho?',
  '20. Sente-se ansioso no trabalho?'
  //... (adicione até P51 se quiser)
];

function checkPassword() {
  const senha = document.getElementById('password').value;
  if (senha === senhaCorreta) {
    document.getElementById('login').classList.add('hidden');
    document.getElementById('panel').classList.remove('hidden');
    loadData();
  } else {
    document.getElementById('loginError').innerText = 'Senha incorreta!';
  }
}

async function loadData() {
  const url = 'https://opensheet.elk.sh/1JEfiKZUMsJv8fGDl1MRTRarItsLWXVYAeAnyWr93ECI/dados';
  const res = await fetch(url);
  globalData = await res.json();
  buildCharts();
}

function buildCharts() {
  const perguntas = Array.from({ length: perguntasTextos.length }, (_, i) => `P${i + 1}`);
  const respostasUnicas = {};
  const colaboradores = [];
  const empresas = [];

  perguntas.forEach(p => respostasUnicas[p] = {});

  globalData.forEach(entry => {
    if (entry.NomeCompleto && !colaboradores.includes(entry.NomeCompleto)) colaboradores.push(entry.NomeCompleto);
    if (entry.Empresa && !empresas.includes(entry.Empresa)) empresas.push(entry.Empresa);
    perguntas.forEach(p => {
      const resposta = entry[p] || 'Sem resposta';
      respostasUnicas[p][resposta] = (respostasUnicas[p][resposta] || 0) + 1;
    });
  });

  document.getElementById('summary').innerHTML = `<strong>Colaboradores:</strong> ${colaboradores.join(', ') || 'Nenhum'}<br><strong>Empresas:</strong> ${empresas.join(', ') || 'Nenhuma'}`;

  const chartsDiv = document.getElementById('charts');
  chartsDiv.innerHTML = '';
  const chartType = document.getElementById('chartType').value;

  perguntas.forEach((p, idx) => {
    const div = document.createElement('div');
    div.className = 'chart-container';
    div.innerHTML = `<div class="question-label">${perguntasTextos[idx] || p}</div><canvas id="chart${idx}"></canvas>`;
    chartsDiv.appendChild(div);

    const ctx = document.getElementById(`chart${idx}`).getContext('2d');
    const labels = Object.keys(respostasUnicas[p]);
    const values = Object.values(respostasUnicas[p]);

    new Chart(ctx, {
      type: chartType,
      data: {
        labels: labels,
        datasets: [{
          label: 'Respostas',
          data: values,
          backgroundColor: chartType === 'bar' ? 'rgba(46,125,50,0.7)' : labels.map(() => `hsl(${Math.random() * 360},70%,60%)`)
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: chartType !== 'bar' } },
        scales: chartType === 'bar' ? { x: { beginAtZero: true } } : {}
      }
    });
  });
}

function reloadCharts() {
  if (globalData) buildCharts();
}
</script>

</body>
</html>
