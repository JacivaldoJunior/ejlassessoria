<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Gráficos - EJL Saúde e Segurança</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f0f8f5; }
    .hidden { display: none; }
    .center { text-align: center; margin-top: 50px; }
    input[type="password"] { padding: 10px; width: 200px; }
    button { padding: 10px 20px; background-color: #2e7d32; color: white; border: none; cursor: pointer; }
    .chart-container { margin: 30px 0; display: flex; align-items: center; }
    .chart-container canvas { max-height: 250px; max-width: 600px; }
    .summary { background: #e8f5e9; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
    select { margin: 10px; padding: 5px; }
    .question-label { width: 300px; font-size: 0.9em; margin-right: 10px; }
  </style>
</head>
<body>

<div id="login" class="center">
  <h2>Painel de Gráficos - Login</h2>
  <input type="password" id="password" placeholder="Digite a senha">
  <button onclick="checkPassword()">Entrar</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="panel" class="hidden">
  <h1>Painel de Gráficos - EJL Saúde e Segurança</h1>
  <div class="summary" id="summary"></div>
  <label for="chartType">Tipo de Gráfico:</label>
  <select id="chartType" onchange="reloadCharts()">
    <option value="bar">Coluna</option>
    <option value="pie">Pizza</option>
    <option value="doughnut">Rosca</option>
    <option value="line">Linha</option>
    <option value="radar">Radar</option>
    <option value="polarArea">Área Polar</option>
  </select>
  <div id="charts"></div>
</div>

<script>
const senhaCorreta = 'admin123';
let globalData = null;

const perguntasTextos = [
  '1. Você tem que realizar atividades que não fazem parte da sua função?',
  '2. A função que você exerce exige um ritmo de trabalho intenso?',
  '3. Seu trabalho exige novas ideias?',
  '4. Seu trabalho exige que saiba lidar com tensão?',
  '5. Você discorda de algumas funções atribuídas?',
  '6. Você se sente inseguro na sua habilidade?',
  '7. Você pode realizar seu trabalho sem pressa?',
  '8. Você se sente tenso durante a atividade?',
  '9. Você está sobrecarregado?',
  '10. Você sente dificuldade para se concentrar?'
  // Adicione mais se quiser
];

function checkPassword() {
  const senha = document.getElementById('password').value;
  if (senha === senhaCorreta) {
    document.getElementById('login').classList.add('hidden');
    document.getElementById('panel').classList.remove('hidden');
    loadData();
  } else {
    document.getElementById('loginError').innerText = 'Senha incorreta!';
  }
}

async function loadData() {
  const url = 'https://opensheet.elk.sh/1JEfiKZUMsJv8fGDl1MRTRarItsLWXVYAeAnyWr93ECI/dados';
  const res = await fetch(url);
  globalData = await res.json();
  buildCharts();
}

function buildCharts() {
  const perguntas = Array.from({ length: perguntasTextos.length }, (_, i) => `P${i + 1}`);
  const respostasUnicas = {};
  const colaboradores = [];
  const empresas = [];

  perguntas.forEach(p => respostasUnicas[p] = {});

  globalData.forEach(entry => {
    if (entry.NomeCompleto && !colaboradores.includes(entry.NomeCompleto)) colaboradores.push(entry.NomeCompleto);
    if (entry.Empresa && !empresas.includes(entry.Empresa)) empresas.push(entry.Empresa);
    perguntas.forEach(p => {
      const resposta = entry[p] || 'Sem resposta';
      respostasUnicas[p][resposta] = (respostasUnicas[p][resposta] || 0) + 1;
    });
  });

  document.getElementById('summary').innerHTML = `<strong>Colaboradores:</strong> ${colaboradores.join(', ') || 'Nenhum'}<br><strong>Empresas:</strong> ${empresas.join(', ') || 'Nenhuma'}`;

  const chartsDiv = document.getElementById('charts');
  chartsDiv.innerHTML = '';
  const chartType = document.getElementById('chartType').value;

  perguntas.forEach((p, idx) => {
    const div = document.createElement('div');
    div.className = 'chart-container';
    div.innerHTML = `<div class="question-label">${perguntasTextos[idx] || p}</div><canvas id="chart${idx}"></canvas>`;
    chartsDiv.appendChild(div);

    const ctx = document.getElementById(`chart${idx}`).getContext('2d');
    const labels = Object.keys(respostasUnicas[p]);
    const values = Object.values(respostasUnicas[p]);

    new Chart(ctx, {
      type: chartType,
      data: {
        labels: labels,
        datasets: [{
          label: 'Respostas',
          data: values,
          backgroundColor: labels.map(() => `hsl(${Math.random() * 360},70%,60%)`)
        }]
      },
      options: {
        indexAxis: chartType === 'bar' ? 'y' : 'x',
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: chartType !== 'bar' } },
        scales: chartType === 'bar' || chartType === 'line' ? { x: { beginAtZero: true }, y: { beginAtZero: true } } : {}
      }
    });
  });
}

function reloadCharts() {
  if (globalData) buildCharts();
}
</script>

</body>
</html>
